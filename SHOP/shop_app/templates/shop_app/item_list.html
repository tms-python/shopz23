{% extends 'shop_app/base.html' %}
{% block title %}
  Список товаров
{% endblock %}

{% block body %}
  <div class="col-lg-12 text-center">
    <a href="{% url 'shop_app:index' %}">На главную</a>
  </div>

  <div class="col-lg-12 mt-2 ">
    <ul class="list-group">
      {% for item in item_list %}
        <li class="list-group-item">
          <a class="my_class" href="{% url 'shop_app:item_update' item.id %}">
            {{ forloop.counter }} {{ item }}
          </a>
        </li>
      {% endfor %}
    </ul>
  </div>
  <div class="col-lg-12 mt-2 text-center ">
    <a class="btn btn-info form-control" href="{% url 'shop_app:item_create' %}">
      Создать продукт
    </a>
  </div>

  <div id="app" class="col-lg-12">
    <div>
      <ul class="list-group">
        <li class="list-group-item"
            v-for="department, index in department_list">
          <span>[[ department.sphere_name]]</span>
          <button
              class="btn btn-danger my_class"
              @click.prevent="delete_department(index)">
            del
          </button>
        </li>
      </ul>
    </div>

    <div class="row">
      <div class="col-lg-12 mt-3">

        <label for="sphere">Сфера</label>
        <select id="sphere" class="form-control"
                v-model="department_object.sphere">
          <option v-for="sphere in sphere_list" :value="sphere.id">
            [[sphere.name]]
          </option>
        </select>

        <label for="staff_amount">Количество сотрудников</label>
        <input id="staff_amount"
               class="form-control"
               type="number" v-model="department_object.staff_amount">

        <label for="shop">Магазин</label>
        <select id="shop" class="form-control"
                v-model="department_object.shop">
          <option
              v-for="shop in shop_list" :value="shop.id">
            [[shop.name]]
          </option>
        </select>
      </div>
    </div>
  </div>

  <script>
    axios_instance.get('{% url "shop_app:department-list" %}').then(response=>{
      console.log(response.data)
    })
  </script>

  <script>
  new Vue({
    el: '#app',
    delimiters: ['[[', ']]'],
    data: function () {
      return {
        department_list: [
          {}
        ],
        sphere_list: [
          {id: '1', name: 'Продукты'},
          {id: '2', name: 'Игрушки'},
          {id: '3', name: 'Одежда'},
        ],
        shop_list: [],
        department_object: {
          id: null,
          sphere: '',
          staff_amount: 0,
          shop: null
        }
      }
    },
    methods: {
      get_department_list: function () {
        axios_instance.get('api/department/').then(response=>{
          this.department_list = response.data
        })
      },
      delete_department: function (index) {
        let element_id = this.department_list[index].id;
        axios_instance.delete(`api/department/${element_id}`).then(response=>{
          if (response.status === 204){
            this.department_list.splice(index, 1)
          }
        })
      },
      get_shop_list: function () {
        axios_instance.get('api/shop/').then(response=>{
          this.shop_list = response.data
        })
      },
    },
    mounted: function () {
      this.get_department_list();
      this.get_shop_list()
    }
  })
</script>
<style>
  button {
    background-color: chocolate;
  }
  .my_class {
    background-color: chocolate;
    border: black;
  }
</style>
{% endblock %}

