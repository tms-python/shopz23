{% extends 'shop_app/base.html' %}
{% block title %}
  Список товаров
{% endblock %}

{% block body %}
  <div class="col-lg-12 text-center">
    <a href="{% url 'shop_app:index' %}">На главную</a>
  </div>

  <div class="col-lg-12 mt-2 ">
    <ul class="list-group">
      {% for item in item_list %}
        <li class="list-group-item">
          <a href="{% url 'shop_app:item_update' item.id %}">
            {{ forloop.counter }} {{ item }}
          </a>
        </li>
      {% endfor %}
    </ul>
  </div>
  <div class="col-lg-12 mt-2 text-center ">
    <a class="btn btn-info form-control" href="{% url 'shop_app:item_create' %}">
      Создать продукт
    </a>
  </div>

  <div id="app" class="col-lg-12">
    <ul class="list-group">
      <li class="list-group-item"
          v-for="department, index in department_list">
        <span>[[ department.sphere_name]]</span>
        <button
            class="btn btn-danger"
            @click.prevent="delete_department(index)">

          del
        </button>
      </li>
    </ul>


  </div>

  <script>
    axios_instance.get('{% url "shop_app:department-list" %}').then(response=>{
      console.log(response.data)
    })
  </script>

  <script>
  new Vue({
    el: '#app',
    delimiters: ['[[', ']]'],
    data: function () {
      return {
        department_list: [
          {
            id: 2,
            shop: 1,
            sphere: "2",
            sphere_name: "sphere_name",
            staff_amount: 0
          }
        ]
      }
    },
    methods: {
      get_department_list: function () {
        axios_instance.get('{% url "shop_app:department-list" %}').then(response=>{
          this.department_list = response.data
        })
      },
      delete_department: function (index) {
        let element_id = this.department_list[index].id;
        axios_instance.delete(`api/department/${element_id}`).then(response=>{
          if (response.status === 204){
            this.department_list.splice(index, 1)
          }
        })
      }
    },
    mounted: function () {
      this.get_department_list()
    }
  })
</script>
{% endblock %}